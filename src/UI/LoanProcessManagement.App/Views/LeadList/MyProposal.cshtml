@using LoanProcessManagement.Application.Features.LeadStatus.Queries.GetPerformanceSummary;
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
 ViewData["Title"] = "LeadStatus";
 var Records = (List<GetPerformanceSummaryQueryDTO>)ViewData["MyProposal"];
}

<div class="container app">
    <div class="col-sm-12 col-lg-12">
        <div data-effect="helix" id="panels" class="panel panel-info effect-helix in" style="transition: all 0.7s ease-in-out 0s;">
            <div class="panel-heading"><h5>Lead Status</h5></div>
            <div class="panel-body ">
                <div class="card" style="padding:5px;">
                    <div class="filters">
                        <div class="form-group">
                            <div class="row">
                                <div class="col-1"></div>
                                <div class="col-3">
                                    <label>Branch</label><span style="color: Red">&nbsp;*</span>
                                </div>
                                <div class="col-3">
                                    <div id="divBranch" class="input-control text">
                                        <select id="DDLBranch" asp-items=Model.getAllBranchesDto class="form-control">
                                            @*<option value="-1">Select</option>*@
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="row">
                                <div class="col-1"></div>
                                <div class="col-3">
                                    <label>Select Role : </label>
                                </div>
                                <div class="col-3">
                                    <div id="divUserType">
                                        <input type="checkbox" class="ch1" name="userType" value="3" checked>
                                        Branch
                                        <input type="checkbox" class="ch2" name="userType" value="4">
                                        DSA
                                    </div>
                                </div>
                                <div class="col-1"></div>
                                <div class="col-3">
                                    @*<input type="button" asp-action="FilterSearch" class="btn btn-primary  btn-sm" onclick="myfun()" value="Submit" id="btnSubmit">*@
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="form-group">
                            <div class="row">
                                <div class="col-lg-12">
                                    <table class="display table table-responsive-xl" id="tblLoginReport">
                                        <thead>
                                            <tr>
                                                <th>FormNo</th>
                                                <th>Customer Name</th>
                                                <th>Status</th>
                                                <th style="display:none">SanctionTAT</th>
                                                <th>In-Prin. Sanc.</th>
                                                <th>Branch Processing</th>
                                                <th>Product Name</th>
                                                <th>Loan Amt.(In Crores)</th>
                                                <th>Insurance Amt.(In Thousands)</th>
                                                <th>Converted Leads</th>
                                                <th>Branch Data Entry Leads</th>
                                                <th>In. Principle Sanction List</th>
                                                <th>Branch Process</th>
                                                <th>3rd Party Check</th>
                                                <th>Sanction</th>
                                                <th>Disbursed</th>
                                                <th>Rejected/Lost Lead</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var record in Records)
                                            {
                                            <tr>
                                                <td>@record.FormNo</td>
                                                <td>@record.CustomerName</td>
                                                <td>@record.Status</td>
                                                <td style="display:none">@record.sanctionTAT</td>
                                                <td>@record.ProductName</td>
                                                <td>@record.LoanAmount</td>
                                                <td>@record.InsuaranceAmount</td>
                                                <td>@record.convertedLead</td>
                                                <td>@record.BranchDataEntry</td>
                                                <td>@record.InPrincipleSanction</td>
                                                <td>@record.BranchProcess</td>
                                                <td>@record.ThirdPartyCheck</td>
                                                <td>@record.Sanction</td>
                                                <td>@record.Disbursement</td>
                                                <td>@record.Rejection</td>
                                            </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function myfun() {
        var user1 = 0;
        var user2 = 0;
        if ($(".ch1").prop('checked') == true) {
            user1 = ($('.ch1').val());
        }
        if ($(".ch2").prop('checked') == true) {
            user2 = ($('.ch2').val());
        }
        $.ajax({
            type: "POST",
            url: "/Leadlist/FilterSearch",
            data: { "Id": $('#DDLBranch').find('option:selected').val(), "userId": user1, "UserId2": user2 },
            success: function (data) {

                var table = $('#tblLoginReport').DataTable();
                table.destroy();

                $('#tblLoginReport tbody').empty();


                $.each(data, function (i, item) {
                    var rows = "<tr>" +
                        "<td>" + item.dsaName + "</td>" +
                        "<td>" + item.totalLead + "</td>" +
                        "<td>" + item.convertedLead + "</td>" +
                        "<td>" + item.branchDataEntry + "</td>" +
                        "<td>" + item.hoInPrinSanction + "</td>" +
                        "<td>" + item.branchCustProcessing + "</td>" +
                        "<td>" + item.branch3rdPartyCheck + "</td>" +
                        "<td>" + item.branchRecord + "</td>" +
                        "<td>" + item.hoSanction + "</td>" +
                        "<td>" + item.rejectedLead + "</td>" +
                        "<td>" + item.sanctionedLead + "</td>" +
                        "<td>" + item.disbursedLead + "</td>" +
                        "<td>" + item.lostLead + "</td>" +
                        "<td>" + item.rejectionPercent + "</td>" +
                        "</tr>";
                    $('#tblLoginReport tbody').append(rows);
                })

                $('#tblLoginReport').DataTable();

            }
        });
    };
</script>
